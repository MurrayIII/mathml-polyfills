<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Browser transform MathML tests</title>
    <meta charset="utf-8"/>
    <script type="module">
      import { _MathTransforms } from './common/math-transforms.js'
      import './mfenced/mfenced.js'
      import './bevelled/bevelled.js'
      import'./accent/accent.js'
      import './mathsize/mathsize.js'
      import './linethickness/linethickness.js'
      import './ms/ms.js'
      import './mtable/mtable.js'
      import './elem-math/elemMath.js'

      window.transform = function(elementId) {
        _MathTransforms.transform(elementId);
      }

    function htmlContents(toc) {
        //toc of contents - remove # if necessary
        let TOC = document.getElementById(toc.replace(/\#/g, ''))

        let headers = document.querySelectorAll('h2');
        //keep track of ids
        let ids = []
        headers.forEach(function(el) {
            // if it has an id already, just add that to the array
            if (el.id) return ids.push(el.id)
            //id will be the textcontent without non-letter characters in lower case
            let id = el.textContent.replace(/[^a-zA-Z]/g, '').toLowerCase() + 'Header'
            while(ids.indexOf(id) !== -1) {
                //add zzz's to the end until we have a unique id
                id = id + 'zzz'
            }
            //ready to be tracked
            ids.push(id)
            //okay we can set now
            el.id = id
        })

        let html = '<ol>'
        headers.forEach(function(h) {
            html += `<li><a href="#${h.id}">${h.textContent}</a></li>`;
        });
        html += '</ol>';

        TOC.insertAdjacentHTML('beforeend', html);
    }
    document.addEventListener("DOMContentLoaded", function(event) {
        htmlContents('#toc')
    })
    </script>
    <style>
        table {
            border-collapse: collapse;
            margin-top: 3ex;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
        }
    </style>
  </head>
  <body>
    <h1>MathML transform tests</h1>
    <p>The following table contains MathML that is not part of core.
        The page loads transforms that will transform the full MathML into MathML core.
        The transforms will <em>not</em> run until you click the button below.
        This allows you to see the effects of the transform.
    </p>
    <p>Examples:</p>
    <div id="toc"></div> <!-- TOC auto built from h2's-->
    <h2>General MathML Elements and Attributes</h2>
    <label>
        Click to see the effect of the transform on the following table:
        <button onclick="transform(general)">Apply Transform</button>    
    </label>
    <table id="general">
          <tr>
              <th>Description</th>
              <th>Math example</th>
          </tr>
          <tr>
              <td>
                 mfenced 
              </td>
              <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                    <mfenced open="[" separators=";" close="]">
                      <mn>0</mn>
                      <mn>1</mn>
                    </mfenced>
                  </math>
              </td>
          </tr>
          <tr>
              <td>
                 bevelled fraction
              </td>
              <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                    <mi>f</mi>
                    <mo>(</mo>
                    <mfrac bevelled="true">
                        <mrow>
                            <mi>x</mi>
                            <mo>+</mo>
                            <mn>1</mn>    
                        </mrow>
                        <mrow>
                            <mi>x</mi>
                            <mo>-</mo>
                            <mn>1</mn>    
                        </mrow>
                    </mfrac> 
                    <mo>)</mo>
                    <mo>+</mo>
                    <mn>1</mn>
                </math>
              </td>
          </tr>
          <tr>
              <td>
                 under/over scripts with an mo that should be displayed as an accent 
              </td>
              <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                    <mover>
                        <mi>x</mi>
                        <mo>&#x21C0;</mo>
                    </mover>
                    <mo>+</mo>
                    <mover>
                        <mi>x</mi>
                        <mo>^</mo>
                    </mover>
                    <mo>+</mo>
                    <munder>
                        <mo>&#x2211;</mo>
                        <mrow>
                            <mi>x</mi>
                            <mo>&#x2208;</mo>
                            <mi>D</mi>
                        </mrow>
                    </munder>
                    <mi>f</mi>
                    <mo>(</mo>
                    <mi>x</mi>
                    <mo>)</mo>
                </math>
              </td>
          </tr>
          <tr>
              <td>
                 mfrac with named linethickness (none, thin, medium, thick, 8px) 
              </td>
              <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML"  display="block">
                    <mfrac>
                        <mn>1</mn>
                        <mn>2</mn>
                    </mfrac>
                    <mo>+</mo>
                    <mfrac linethickness="thin">
                        <mn>1</mn>
                        <mn>3</mn>
                    </mfrac>
                    <mo>+</mo>
                    <mfrac linethickness="medium">
                        <mn>1</mn>
                        <mn>4</mn>
                    </mfrac>
                    <mo>+</mo>
                    <mfrac linethickness="thick">
                        <mn>1</mn>
                        <mn>5</mn>
                    </mfrac>
                    <mo>+</mo>
                    <mfrac linethickness="8px">
                        <mn>1</mn>
                        <mn>6</mn>
                    </mfrac>
                </math>
            </td>
          </tr>
          <tr>
              <td>
                  fraction with named mathsize for numerator
                  (none, small, medium, big, 20px) 
              </td>
              <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML"  display="block">
                    <mfrac>
                        <mn>1</mn>
                        <mn>2</mn>
                    </mfrac>
                    <mo>+</mo>
                    <mfrac>
                        <mn mathsize="small">1</mn>
                        <mn>3</mn>
                    </mfrac>
                    <mo>+</mo>
                    <mfrac>
                        <mn mathsize="medium">1</mn>
                        <mn>4</mn>
                    </mfrac>
                    <mo>+</mo>
                    <mfrac>
                        <mn mathsize="big">1</mn>
                        <mn>5</mn>
                    </mfrac>
                    <mo>+</mo>
                    <mfrac>
                        <mn mathsize="20px">1</mn>
                        <mn>6</mn>
                    </mfrac>
                </math>
            </td>
          </tr>
          <tr>
            <td>
               ms -- default quotes and curly quotes; internal quotes should be escaped 
            </td>
            <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                    <mi>f</mi>
                    <mo>(</mo>
                    <ms>normal &quot;s</ms>
                    <mo>,</mo>
                    <ms lquote="“" rquote="”">open/close quotes</ms>
                    <mo>)</mo>
                </math>
            </td>
        </tr>
    </table>

    <h2>MathML Table elements and Attributes</h2>
    <label>
        Click to see the effect of the transform on the following table:
        <button onclick="transform(mtable)">Apply Transform</button>    
    </label>
    <table id="mtable">
          <tr>
            <td>
                mlabeledtr  -- label should be on right of line 
            </td>
            <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                    <mtable width="100%" columnwidth="auto fit">
                        <mlabeledtr id='e-is-m-c-square'>
                          <mtd>
                            <mtext> (2.1) </mtext>
                          </mtd>
                          <mtd>
                           <mrow>
                             <mi>E</mi>
                             <mo>=</mo>
                             <mrow>
                              <mi>m</mi>
                              <mo>&#x2062;<!--INVISIBLE TIMES--></mo>
                              <msup>
                               <mi>c</mi>
                               <mn>2</mn>
                              </msup>
                             </mrow>
                           </mrow>
                          </mtd>
                        </mlabeledtr>
                    </mtable>
                </math>
            </td>
        </tr>
        <tr>
            <td>
                mlabeledtr  -- label should be on left of rows 1 and 3 
            </td>
            <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                    <mtable side='left' width="100%" columnwidth="auto fit">
                        <mtr><mtd><mtext>Famous Formulas</mtext></mtd></mtr>
                        <mlabeledtr>
                          <mtd>
                            <mtext> (3.1) </mtext>
                          </mtd>
                          <mtd>
                            <msup>
                                <mi>e</mi>
                                <mrow>
                                    <mi>i</mi>
                                    <mi mathvariant="normal">&#x3C0;</mi>
                                </mrow>
                            </msup>
                            <mo>+</mo>
                            <mn>1</mn>
                            <mo>=</mo>
                            <mn>0</mn>
                          </mtd>
                        </mlabeledtr>
                        <mtr>
                          <mtd>
                            <msup>
                                <mi>a</mi>
                                <mn>2</mn>
                            </msup>
                            <mo>+</mo>
                            <msup>
                                <mi>b</mi>
                                <mn>2</mn>
                            </msup>
                            <mo>=</mo>
                            <msup>
                                <mi>c</mi>
                                <mn>2</mn>
                            </msup>
                          </mtd>
                        </mtr>
                        <mlabeledtr>
                          <mtd>
                            <mtext> (2.3) </mtext>
                          </mtd>
                          <mtd>
                           <mrow>
                             <mi>E</mi>
                             <mo>=</mo>
                             <mrow>
                              <mi>m</mi>
                              <mo>&#x2062;<!--INVISIBLE TIMES--></mo>
                              <msup>
                               <mi>c</mi>
                               <mn>2</mn>
                              </msup>
                             </mrow>
                           </mrow>
                          </mtd>
                        </mlabeledtr>
                    </mtable>
                </math>
            </td>
        </tr>
    </table>

    <h2>Elementary Math</h2>
    <label>
        Click to see the effect of the transform on the following table:
        <button onclick="transform(elemMath)">Apply Transform</button>    
    </label>
    <table id='elemMath'>
        <tr>
            <td>Elementary math: 2D subtraction problem with borrows and carries</td>
            <td><math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
              <mstack>
                <mscarries location='nw'>
                  <none/>
                  <mscarry crossout='updiagonalstrike' location='n'> <mn>2</mn> </mscarry>
                  <mn>1</mn>
                  <none/>
                </mscarries>
                <mn>2,327</mn>
                <msrow> <mo>-</mo> <mn> 1,156</mn> </msrow>
                <msline/>
                <mn>1,171</mn>
              </mstack>
            </math>
            </td>
        </tr>
        <tr>
            <td>Elementary math: Repeating decimals (line over fractional part)</td>
            <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                    <mstack stackalign="right">
                      <msline length="6"/>
                      <mn> 0.142857 </mn>
                    </mstack>
                  </math>
            </td>
        </tr>
        <tr>
            <td>Elementary math: Long Division</td>
            <td>
                <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                    <mlongdiv longdivstyle="lefttop">
                      <mn> 3 </mn>
                      <mn> 435.3</mn>
                    
                      <mn> 1306</mn>
                    
                      <msgroup position="2" shift="-1">
                        <msgroup>
                          <mn> 12</mn>
                          <msline length="2"/>
                        </msgroup>
                        <msgroup>
                          <mn> 10</mn>
                          <mn> 9</mn>
                          <msline length="2"/>
                        </msgroup>
                        <msgroup>
                          <mn> 16</mn>
                          <mn> 15</mn>
                          <msline length="2"/>
                          <mn> 1.0</mn>           <!-- aligns on '.', not the right edge ('0') -->
                        </msgroup>
                        <msgroup position='-1'>   <!-- extra shift to move to the right of the "." -->
                           <mn> 9</mn>
                          <msline length="3"/>
                          <mn> 1</mn>
                        </msgroup>
                      </msgroup>
                    </mlongdiv>
                  </math>
            </td>
        </tr>
          
    </table>
</body>
</html>